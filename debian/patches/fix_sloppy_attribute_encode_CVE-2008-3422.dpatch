#! /bin/sh /usr/share/dpatch/dpatch-run
## fix_sloppy_attribute_encode_CVE-2008-3422.dpatch by Jo Shields <directhex@apebox.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: HTML encode attributes to avoid ASP.NET XSS attack

@DPATCH@
Index: mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlForm.cs
===================================================================
--- mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlForm.cs	(revision 108743)
+++ mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlForm.cs	(working copy)
@@ -279,7 +279,7 @@
 				w.WriteAttribute ("name", Name);
 
 			w.WriteAttribute ("method", Method);
-			w.WriteAttribute ("action", action);
+			w.WriteAttribute ("action", action, true);
 
 			/*
 			 * This is a hack that guarantees the ID is set properly for HtmlControl to
Index: mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlInputRadioButton.cs
===================================================================
--- mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlInputRadioButton.cs	(revision 108743)
+++ mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlInputRadioButton.cs	(working copy)
@@ -126,7 +126,7 @@
 			if (Page != null)
 				Page.ClientScript.RegisterForEventValidation (this.UniqueID, Value);
 #endif
-			writer.WriteAttribute ("value", Value);
+			writer.WriteAttribute ("value", Value, true);
 			Attributes.Remove ("value");
 			base.RenderAttributes (writer);
 		}
Index: mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlSelect.cs
===================================================================
--- mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlSelect.cs	(revision 108743)
+++ mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlSelect.cs	(working copy)
@@ -693,7 +693,7 @@
 					}
 				}
 				
-				w.WriteAttribute ("value", item.Value);
+				w.WriteAttribute ("value", item.Value, true);
 				w.Write (HtmlTextWriter.TagRightChar);
 				
 				w.Write (item.Text);
Index: mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlControl.cs
===================================================================
--- mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlControl.cs	(revision 108743)
+++ mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlControl.cs	(working copy)
@@ -90,7 +90,7 @@
 					catch (Exception) {
 						throw new HttpException(attribName + " property had malformed url");
 					}
-					writer.WriteAttribute(attribName, attr);
+					writer.WriteAttribute(attribName, attr, true);
 					Attributes.Remove(attribName);
 				}
 			}
Index: mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlInputButton.cs
===================================================================
--- mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlInputButton.cs	(revision 108743)
+++ mono-1.9.1+dfsg/mcs/class/System.Web/System.Web.UI.HtmlControls/HtmlInputButton.cs	(working copy)
@@ -302,7 +302,7 @@
 				
 				if (oc != null) {
 					writer.WriteAttribute ("language", "javascript");
-					writer.WriteAttribute ("onclick", oc);
+					writer.WriteAttribute ("onclick", oc, true);
 				}
 			}
 #endif
